---
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D OBJ Viewer</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }
#menu { position:absolute; top:10px; left:10px; z-index:10; background: rgba(255,255,255,0.8); padding:5px; border-radius:5px; }
</style>
</head>
<body>
<div id="menu">
<label for="fileSelect">Select 3D file:</label>
<select id="fileSelect">
<option value="tinker.obj">tinker.obj</option>
</select>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';
import { MTLLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/MTLLoader.js';
import { OBJLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/OBJLoader.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xaaaaaa);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,1,3);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light);
scene.add(new THREE.AmbientLight(0xffffff,0.4));

let currentModel = null;

function loadOBJ(objPath) {
    if(currentModel) scene.remove(currentModel);

    const mtlPath = objPath.replace('.obj','.mtl');
    const mtlLoader = new MTLLoader();
    mtlLoader.load(mtlPath, materials => {
        materials.preload();
        const objLoader = new OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.load(objPath, object => {
            currentModel = object;
            // center
            const box = new THREE.Box3().setFromObject(currentModel);
            const center = box.getCenter(new THREE.Vector3());
            currentModel.position.sub(center);
            scene.add(currentModel);
        });
    });
}

const select = document.getElementById('fileSelect');
loadOBJ(select.value);

select.addEventListener('change', e => loadOBJ(e.target.value));

function animate() {
    requestAnimationFrame(animate);
    if(currentModel) currentModel.rotation.y += 0.01;
    renderer.render(scene, camera);
}
animate();

window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
